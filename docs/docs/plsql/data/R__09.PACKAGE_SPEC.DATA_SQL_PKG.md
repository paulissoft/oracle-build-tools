<!-- DO NOT EDIT THIS FILE DIRECTLY - it is generated from source file db/app/data/src/full/R__09.PACKAGE_SPEC.DATA_SQL_PKG.sql -->
<!-- markdownlint-disable MD003 MD012 MD024 MD033 -->

- [Package "DATA_SQL_PKG"](#package-data_sql_pkg)
- [Type statement_tab_t](#type-statement_tab_t)
- [Type max_row_count_tab_t](#type-max_row_count_tab_t)
- [Procedure do](#procedure-do)
- [Procedure do](#procedure-do-1)


# Package "DATA_SQL_PKG"

Use dynamic SQL to retrieve data as either scalars or arrays by using SYS.ANYDATA.
It is essentially created to enable SQL on a set of related tables, i.e. tables with a foreign key relation.

Only (scalar and array) types supported by DBMS_SQL and ANYDATA are supported by this package.

Scalar data types supported:

| SQL data type                     | Convert to anydata function | ANYDATA type                |
| :------------                     | :-------------------------- | :-----------                |
| CLOB                              |                             | SYS.CLOB                    |               
| BINARY_FLOAT                      |                             | SYS.BINARY_FLOAT            |
| BINARY_DOUBLE                     |                             | SYS.BINARY_DOUBLE           |
| BLOB                              |                             | SYS.BLOB                    |
| BFILE                             |                             | SYS.BFILE                   |
| DATE                              |                             | SYS.DATE                    |
| NUMBER                            |                             | SYS.NUMBER                  |
| UROWID                            |                             | SYS.UROWID                  |
| VARCHAR2                          |                             | SYS.VARCHAR2                |
| TIMESTAMP                         |                             | SYS.TIMESTAMP               |
| TIMESTAMP(6) WITH LOCAL TIME ZONE |                             | SYS.TIMESTAMP_WITH_LTZ      |
| TIMESTAMP(6) WITH TIME ZONE       |                             | SYS.TIMESTAMP_WITH_TIMEZONE |
| INTERVAL DAY(2) TO SECOND(6)      |                             | SYS.INTERVAL_DAY_SECOND     |
| INTERVAL YEAR(2) TO MONTH         |                             | SYS.INTERVAL_YEAR_MONTH     |

 
Array types supported (see 1 below for PL/SQL type names):
- SYS.CLOB_TABLE
- SYS.BINARY_FLOAT_TABLE
- SYS.BINARY_DOUBLE_TABLE
- SYS.BLOB_TABLE
- SYS.BFILE_TABLE
- SYS.DATE_TABLE
- SYS.NUMBER_TABLE
- SYS.UROWID_TABLE
- SYS.VARCHAR2_TABLE
- SYS.TIMESTAMP_TABLE
- SYS.TIMESTAMP_WITH_LTZ_TABLE
- SYS.TIMESTAMP_WITH_TIME_ZONE_TABLE (see 2)
- SYS.INTERVAL_DAY_TO_SECOND_TABLE (see 3)
- SYS.INTERVAL_YEAR_TO_MONTH_TABLE (see 4)

PL/SQL type names (not supported in SQL!):
1. Please note that it is usually the anydata scalar type name with '_TABLE' as suffix but with some exceptions:
2. Not SYS.TIMESTAMP_WITH_TIMEZONE_TABLE
3. Not SYS.INTERVAL_DAY_SECOND_TABLE
4. Not SYS.INTERVAL_YEAR_MONTH_TABLE

In PL/SQL you replace SYS. by DBMS_SQL. (they are all defined there), so DBMS_SQL.CLOB_TABLE, DBMS_SQL.BINARY_FLOAT_TABLE and so on.
 
This package has AUTHID CURRENT_USER so that it can be used by 
any schema to which this package has been granted.

SIGNATURE

```sql
PACKAGE "DATA_SQL_PKG" authid current_user is

-- SYS.STANDARD defines TIME_UNCONSTRAINED and TIME_TZ_UNCONSTRAINED but there is no anydata.Convert* function for it.
c_support_time constant boolean := false;

-- use SYS.ODCINUMBERLIST and so on
c_use_odci constant boolean := false;

-- ORA-03001: unimplemented feature
e_unimplemented_feature exception;
pragma exception_init(e_unimplemented_feature, -3001);
```


## Type statement_tab_t

Sometimes a parent or child table may have a selection not so simple as "select * from <table>".

SIGNATURE

```sql
type statement_tab_t is table of statement_t index by all_tab_columns.table_name%type;
```


## Type max_row_count_tab_t

Specify the maximum row count to fetch for a table.

SIGNATURE

```sql
type max_row_count_tab_t is table of positive index by all_tab_columns.table_name%type;
```


## Procedure do

Perform SQL for a single table.

The value for p_max_row_count determines how and how much rows is retrieved for a query (select):
- when 1: select just a single row (and raise exceptions no_data_found / too_many_rows when no or more than 1 row is fetched) and store them in scalars
- when null: unlimited number of fetches and store them in arrays (even though at most 1 row may be fetched)
- when greater than 1: fetch at most this amount of rows and store them in arrays (even though at most 1 row may be fetched)

SIGNATURE

```sql
procedure do
( p_operation in varchar2 -- (S)elect, (I)nsert, (U)pdate or (D)elete
, p_table_name in varchar2 -- the table name
, p_bind_variable_tab in column_value_tab_t default empty_column_value_tab -- only when an entry exists that table column will be used in the query or DML
, p_statement in statement_t default null -- if null it will default to 'select * from <table>' for a (S)elect
, p_order_by in varchar2 default null -- to be added after the (default) query (without ORDER BY)
, p_owner in varchar2 default user -- the owner of the table
, p_max_row_count in positive default null
, p_column_value_tab in out nocopy column_value_tab_t -- only when an entry exists that table column will be used in the query or DML
);
```


## Procedure do

Perform SQL for a set of related tables.

SIGNATURE

```sql
procedure do
( p_operation in varchar2 -- (S)elect, (I)nsert, (U)pdate or (D)elete
, p_parent_table_name in varchar2 -- we must start with this
, p_table_bind_variable_tab in table_column_value_tab_t -- only when an entry exists that table column will be used in the query or DML
, p_statement_tab in statement_tab_t default empty_statement_tab -- per table a query (if any): if none or null it will default to 'select * from <table>' for a (S)elect
, p_order_by_tab in statement_tab_t default empty_statement_tab -- per table an order by (if any)
, p_owner in varchar2 default user -- the owner of the table(s)
, p_max_row_count_tab in max_row_count_tab_t default empty_max_row_count_tab -- per table a max row count (if any)
, p_table_column_value_tab in out nocopy table_column_value_tab_t -- only when an entry exists that table column will be used in the query or DML
);
```


