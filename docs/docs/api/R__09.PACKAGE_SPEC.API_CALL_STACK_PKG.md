<!-- DO NOT EDIT THIS FILE DIRECTLY - it is generated from source file db/app/api/src/full/R__09.PACKAGE_SPEC.API_CALL_STACK_PKG.sql -->
<!-- markdownlint-disable MD003 MD012 MD024 MD033 -->

- [Package "API_CALL_STACK_PKG"](#package-api_call_stack_pkg)
- [Type t_call_stack_rec](#type-t_call_stack_rec)
- [Type t_call_stack_tab](#type-t_call_stack_tab)
- [Type t_error_stack_rec](#type-t_error_stack_rec)
- [Type t_error_stack_tab](#type-t_error_stack_tab)
- [Type t_backtrace_stack_rec](#type-t_backtrace_stack_rec)
- [Type t_backtrace_stack_tab](#type-t_backtrace_stack_tab)
- [Function get_call_stack](#function-get_call_stack)
- [Function repr](#function-repr)
- [Function repr](#function-repr-1)
- [Function get_error_stack](#function-get_error_stack)
- [Function repr](#function-repr-2)
- [Function repr](#function-repr-3)
- [Function get_backtrace_stack](#function-get_backtrace_stack)
- [Function repr](#function-repr-4)
- [Function repr](#function-repr-5)
- [Procedure show_stack](#procedure-show_stack)


# Package "API_CALL_STACK_PKG"

This package is a layer on top of UTL_CALL_STACK. It reverses the direction of a call stack compared to UTL_CALL_STACK which has the newest call entries at the lowest index entries. For instance the call with dynamic depth equal to UTL_CALL_STACK.DYNAMIC_DEPTH is the oldest (first) call. In this package it is the reverse which has as advantage that an entry in the call stack with dynamic depth equal to X will still have the same dynamic depth when another call is made. 

The same is true for the error stack: originating error first but that was already the case for UTL_CALL_STACK.

The same is true for the backtrace stack: originating call first unlike UTL_CALL_STACK.

SIGNATURE

```sql
PACKAGE "API_CALL_STACK_PKG" authid definer
is

subtype t_repr_tab is utl_call_stack.unit_qualified_name; -- a table type allowing us to use member of
```


## Type t_call_stack_rec

The call stack record type.

SIGNATURE

```sql
type t_call_stack_rec is record
( dynamic_depth pls_integer
, lexical_depth pls_integer
, owner all_objects.owner%type
, unit_type all_objects.object_type%type
, subprogram utl_call_stack.unit_qualified_name
, name varchar2(32767) -- the result of UTL_CALL_STACK.CONCATENATE_SUBPROGRAM() 
, unit_line pls_integer
);
```


## Type t_call_stack_tab

The call stack table type.

SIGNATURE

```sql
type t_call_stack_tab is table of t_call_stack_rec index by binary_integer;
```


## Type t_error_stack_rec

The error stack record type.

SIGNATURE

```sql
type t_error_stack_rec is record
( error_depth pls_integer
, error_number pls_integer
, error_msg varchar2(32767)
);
```


## Type t_error_stack_tab

The error stack table type.

SIGNATURE

```sql
type t_error_stack_tab is table of t_error_stack_rec index by binary_integer;
```


## Type t_backtrace_stack_rec

The backtrace stack record type.

SIGNATURE

```sql
type t_backtrace_stack_rec is record
( backtrace_depth pls_integer
, backtrace_line pls_integer
, backtrace_unit varchar2(32767)
);
```


## Type t_backtrace_stack_tab

The backtrace stack table type.

SIGNATURE

```sql
type t_backtrace_stack_tab is table of t_backtrace_stack_rec index by binary_integer;
```


## Function get_call_stack

Get the call stack as defined by UTL_CALL_STACK but with the oldest call first. 
The dynamic_depth field will be the same as the index in the output array.

The default invocation get_call_stack will return an array of length
utl_call_stack.dynamic_depth with the first entry having field dynamic_depth
equal to 1 and the last entry has dynamic_depth equal to
utl_call_stack.dynamic_depth.

SIGNATURE

```sql
function get_call_stack
( p_start in pls_integer default 1 -- You can use -1 like the POSITION parameter in the SUBSTR() function
, p_size in naturaln default utl_call_stack.dynamic_depth -- This will skip the call to API_CALL_STACK_PKG.GET_CALL_STACK() itself
)
return t_call_stack_tab;
```


## Function repr

Get the representation of a call that is a string with these fields separated by a bar (|):
- dynamic_depth
- lexical_depth
- owner
- unit_type
- name
- unit_line

SIGNATURE

```sql
function repr
( p_call_stack_rec in t_call_stack_rec
)
return varchar2
deterministic;
```


## Function repr

Get the representation of each call and return those representations.

SIGNATURE

```sql
function repr
( p_call_stack_tab in t_call_stack_tab
)
return t_repr_tab
deterministic;
```


## Function get_error_stack

Get the error stack as defined by UTL_CALL_STACK but with the oldest call first. 
The error_depth field will be the same as the index in the output array.

SIGNATURE

```sql
function get_error_stack
( p_start in pls_integer default 1 -- You can use -1 like the POSITION parameter in the SUBSTR() function
, p_size in naturaln default utl_call_stack.error_depth
)
return t_error_stack_tab;
```


## Function repr

Get the representation of an error call that is a string with these fields separated by a bar (|):
- error_depth
- error_number
- error_msg

SIGNATURE

```sql
function repr
( p_error_stack_rec in t_error_stack_rec
)
return varchar2
deterministic;
```


## Function repr

Get the representation of each error call and return those representations.

SIGNATURE

```sql
function repr
( p_error_stack_tab in t_error_stack_tab
)
return t_repr_tab
deterministic;
```


## Function get_backtrace_stack

Get the backtrace stack as defined by UTL_CALL_STACK but with the oldest backtrace first. 
The backtrace_depth field will be the same as the index in the output array.

SIGNATURE

```sql
function get_backtrace_stack
( p_start in pls_integer default 1 -- You can use -1 like the POSITION parameter in the SUBSTR() function
, p_size in naturaln default utl_call_stack.backtrace_depth
)
return t_backtrace_stack_tab;
```


## Function repr

Get the representation of a backtrace call that is a string with these fields separated by a bar (|):
- backtrace_depth
- backtrace_line
- backtrace_unit

SIGNATURE

```sql
function repr
( p_backtrace_stack_rec in t_backtrace_stack_rec
)
return varchar2
deterministic;
```


## Function repr

Get the representation of each backtrace call and return those representations.

SIGNATURE

```sql
function repr
( p_backtrace_stack_tab in t_backtrace_stack_tab
)
return t_repr_tab
deterministic;
```


## Procedure show_stack

Show the current call, error and backtrace stack using DBMS_OUTPUT.

SIGNATURE

```sql
procedure show_stack
( p_where_am_i in varchar2 -- place to show
);
```


